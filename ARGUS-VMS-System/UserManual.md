# Copyright 2025 Moonlight Technologies Inc.. All Rights Reserved.
# Auth Masahiro Aoki

# ARGUS-System ユーザーマニュアル

## 1. はじめに
このマニュアルは、ARGUS-System VMSの利用方法について解説します。対象読者は、システムの監視を行うオペレーターおよび、システムの管理を行う管理者です。

## 2. ログイン
システムを利用するには、まずログイン画面で提供されたユーザー名とパスワードを入力してログインしてください。
- **URL:** `http://<サーバーのIPアドレス>:3000`

## 3. 基本的な画面構成
ログイン後、メインの監視画面が表示されます。画面は主に3つのエリアに分かれています。

1.  **トップバー (AppBar):**
    -   システム名、接続ステータス、ログイン中のユーザー名が表示されます。
    -   **通知アイコン (ベル):** カメラのオフラインなど、システムアラートがある場合にバッジで件数を表示します。クリックするとアラート内容を確認できます。
    -   各種設定画面へのボタン（プロファイル、システムヘルス）やログアウトボタンがあります。
    -   言語切り替え（日本語/英語）が可能です。

2.  **ビデオグリッド (中央):**
    -   カメラのライブ映像を表示するメインエリアです。レイアウトは1x1, 2x2, 3x3, 4x4から選択できます。
    -   各セルをクリックすると、そのセルが選択状態（青い枠線）になります。コントロールパネルの操作は、この選択されたセルに対して行われます。

3.  **コントロールパネル (右側):**
    -   システムの各種操作を行うためのパネルです。
    -   **レイアウト変更:** ビデオグリッドの分割数を変更します。
    -   **カメラ選択:** 選択中のセルに表示するカメラをドロップダウンから選びます。
    -   **録画検索:** カレンダーとタイムラインを使って過去の録画を探します。
    -   **システム管理:** 管理者向けに、カメラ管理、ユーザー管理、監査ログ閲覧画面へのボタンが表示されます。

## 4. 主な操作方法

### 4.1. ライブ映像の表示
1.  コントロールパネルで、表示したいレイアウト（例: 2x2）を選択します。
2.  ビデオグリッド内のセルをクリックして選択します。
3.  コントロールパネルのカメラドロップダウンから、表示したいカメラを選択します。
4.  セルの中の「Connect Live」ボタンをクリックすると、ライブ映像の表示が開始されます。

### 4.2. 録画の検索と再生
1.  ライブ映像を表示しているセルをクリックして選択します。
2.  コントロールパネルのカレンダーで、検索したい日付を選択します。
3.  タイムラインに、その日に録画されたデータが表示されます。
    -   **青いバー:** 常時録画されたセグメントです。
    -   **赤いマーカー:** AIモーション検知などのイベントが発生した地点です。
4.  タイムライン上の青いバーをクリックすると、その時点の録画が再生されます。（この機能は現在UI上では部分的な実装です）

### 4.3. 緊急通報 (RTMPストリーミング)
本システムでは、PCやスマートフォンからRTMPプロトコルで映像を配信することで、緊急通報として扱うことができます。

1.  OBS Studio (PC) や Larix Broadcaster (スマートフォン) などのRTMP配信ソフトウェアを用意します。
2.  以下の設定で配信を開始します。
    -   **サーバーURL:** `rtmp://<サーバーのIPアドレス>:1935/live`
    -   **ストリームキー:** 他のユーザーと重複しない、一意の文字列（例: `user-aoki-emergency-20250924`）
3.  配信を開始すると、**システムにログインしている全ユーザーの画面**に、あなたの配信映像が緊急アラートとしてポップアップ表示されます。
4.  配信を停止すると、イベント録画として60秒間の映像が保存されます。

## 5. 管理者向け機能
管理者権限を持つユーザーは、コントロールパネル下部の「システム管理」セクションから以下の機能を利用できます。

### 5.1. カメラ管理
- 新しいIPカメラ（ONVIFまたはRTSP）の登録、設定変更、削除ができます。

### 5.2. ユーザー管理
- 新しいユーザーの作成、役割（管理者/オペレーター）の変更、削除ができます。

### 5.3. 監査ログの確認
- 「Audit Logs」ボタンをクリックすると、監査ログ閲覧ダイアログが開きます。
- **機能:**
    -   システム内で行われた重要な操作（誰が、いつ、何をしたか）が時系列で表示されます。
    -   **フィルタリング:** 日付範囲、ユーザー名、アクションの種類でログを絞り込み検索できます。
    -   **詳細表示:** 各ログの左側にある矢印アイコンをクリックすると、操作に関する詳細なJSONデータを確認できます。
- **主な記録対象アクション:**
    -   `LOGIN_SUCCESS` / `LOGIN_FAILED`: ログイン成功/失敗
    -   `USER_CREATE` / `USER_DELETE`: ユーザーの作成/削除
    -   `CAMERA_CREATE` / `CAMERA_UPDATE` / `CAMERA_DELETE`: カメラの作成/更新/削除
    -   `PTZ_CONTROL`: PTZ操作の実行
