# Copyright 2025 Moonlight Technologies Inc.. All Rights Reserved.
# Auth Masahiro Aoki

# EvoSpikeNet: 主要な概念

**最終更新日:** 2025年10月11日

このドキュメントは、EvoSpikeNetフレームワークの中核をなす、より高度でユニークな概念について技術的な詳細を解説します。

---

## 1. コアSNNアーキテクチャ (`evospikenet/core.py`)

`evospikenet.core`モジュールは、EvoSpikeNetの根幹をなす、状態を持つ（stateful）SNNモデルの基本コンポーネントを定義します。当初は単一のデータストリームを処理する設計でしたが、効率的な学習を実現するために**バッチ処理**に完全対応するよう拡張されました。

- **`SNNModel`**: 複数のニューロン層とシナプスを束ね、時間ステップごとのシミュレーションを実行する高レベルのコンテナです。入力データの次元を自動的に判別し、単一データ（2Dテンソル）とバッチデータ（3Dテンソル）の両方を透過的に処理します。
- **`LIFNeuronLayer`**: LIF（Leaky Integrate-and-Fire）ニューロンの層を実装します。内部の状態である膜電位（`potential`）は、バッチサイズに応じて動的に確保されるようになり、複数の入力を並列で処理できます。
- **`SynapseMatrixCSR`**: CSR形式のスパース行列を用いて、効率的なシナプス結合を表現します。このクラスも、単一入力とバッチ入力の両方に対応できるように`forward`メソッドが改良されています。

このバッチ処理への対応は、後述する自己学習のような、現代的な深層学習の手法をSNNに適用するための重要な基盤となります。

---

## 2. 自己学習 (Self-Supervised Learning) (`evospikenet/ssl.py`)

`evospikenet.ssl`モジュールは、ラベルなしデータから特徴表現を学習するための自己学習メカニズムを実装します。これにより、大量のデータを用いてSNNを事前学習させ、下流タスクの性能とデータ効率を向上させることができます。

### 2.1. ContrastiveSelfSupervisedLayer

SimCLRなどの研究にインスパイアされた`ContrastiveSelfSupervisedLayer`は、対照学習をSNNに適用するための中核モジュールです。

#### 動作原理
1.  **データ拡張とペア生成**: 同じデータサンプルから生成された異なる拡張ビューを「ポジティブペア」、バッチ内の他のサンプルを「ネガティブペア」と見なします。
2.  **特徴抽出と射影**: SNNモデルがスパイク列から特徴埋め込みを生成し、それが「射影ヘッド」を通して渡されます。
3.  **NT-Xent損失による学習**: NT-Xent損失関数を用いて、ポジティブペア間の類似度を最大化し、ネガティブペア間の類似度を最小化します。損失は代理勾配を用いて逆伝播されます。

このプロセスにより、モデルはラベルを必要とせずに、入力データの高レベルな特徴表現を自ら学習することができます。

---

## 3. 高度な制御システム (`evospikenet/control.py`)

`evospikenet.control`モジュールは、外部のメタレベルからSNNの学習と動作を制御するためのメカニズムを提供します。

### 3.1. MetaSTDP (メタ学習による可塑性制御)

`MetaSTDP`クラスは、全体的な報酬信号に基づいて、全ニューロンの学習関連パラメータ（例：膜電位の減衰率）を動的に調整するメタ学習エージェントとして機能します。

### 3.2. AEG (活動駆動型エネルギーゲーティング)

`AEG`クラスは、ニューロン群の活動に応じてエネルギーを動的に管理するメカニズムです。エネルギーが低い場合はスパイクを抑制し、外部からの報酬に基づいてエネルギーを補充します。

---

## 4. 量子インスパイアード自己組織化 (`evospikenet/annealing.py`)

`evospikenet/annealing.py`にある`GraphAnnealingRule`クラスは、シミュレーテッドアニーリングを用いてグラフの構造を最適化する、量子インスパイアードなアルゴリズムです。グラフをIsingモデルにマッピングし、低エネルギー配置を探すことで、階層的な構造やコミュニティパターンを明らかにします。

---

## 5. RAGシステムのデータ永続化と管理 (`evospikenet/rag_milvus.py`)

`evospikenet/rag_milvus.py`モジュールは、RAG（検索拡張生成）システムの知識ベースとして機能するMilvusベクターデータベースとの連携を担当します。このモジュールは、データの永続化と管理に関する全てのロジックをカプセル化しています。

### 5.1. Milvusとの連携
Milvusは、高次元のベクトルデータを効率的に保存、検索するための専門データベースです。本フレームワークでは、テキストデータを`SentenceTransformer`を用いてベクトル化し、Milvusに格納します。RAGシステムがクエリを受け取ると、Milvus内で類似ベクトル検索を行い、関連性の高いドキュメントを迅速に特定します。

### 5.2. データ管理機能 (CURD)
ダッシュボードの「RAG System」ページにある「Data CURD」タブを通じて、Milvusに格納された知識ベースのドキュメントを直接管理できます。
- **Create:** 新しいテキストドキュメントを追加します。
- **Read:** 全てのドキュメントをテーブル形式で表示します。
- **Update:** 既存のドキュメントのテキストやソースを編集します。
- **Delete:** 不要になったドキュメントを削除します。

このインターフェースにより、外部ツールを必要とせずに、アプリケーション内で知識ベースのメンテナンスが完結します。